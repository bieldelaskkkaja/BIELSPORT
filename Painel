import streamlit as st
import pandas as pd
import plotly.express as px
from scraper import coletar_dados, LEAGUES
from processador import gerar_sugestoes_time, gerar_sugestoes_jogador

st.set_page_config(page_title="IA Biel Sports", layout="wide")

st.title("âš½ IA Biel Sports â€“ EstatÃ­sticas + PrevisÃµes para Apostas")

# SeleÃ§Ã£o da liga
liga = st.selectbox("ğŸŒ Escolha uma liga:", list(LEAGUES.keys()))
df_jogadores, df_times = coletar_dados(liga)

# SeleÃ§Ã£o do time
time = st.selectbox("ğŸŸï¸ Selecione um time:", sorted(df_times['Squad'].unique()))
df_time_selecionado = df_times[df_times['Squad'] == time].copy()

# SugestÃµes automÃ¡ticas
sugestoes_time = gerar_sugestoes_time(df_time_selecionado.iloc[0])

st.subheader(f"ğŸ“Š EstatÃ­sticas do {time}")
st.write(df_time_selecionado.set_index("Squad").T)
st.markdown("**ğŸ¤– SugestÃµes da IA:**")
for s in sugestoes_time:
    st.info(s)

# GrÃ¡fico do time
st.subheader("ğŸ“ˆ GrÃ¡fico â€“ Time")
fig_time = px.bar(df_time_selecionado.melt(id_vars=["Squad"], value_vars=["Gls", "Sh", "SoT", "CrdY"]),
                  x='variable', y='value', color='variable', title=f"{time} â€“ EstatÃ­sticas")
st.plotly_chart(fig_time)

# Jogadores do time
jogadores_time = df_jogadores[df_jogadores['Squad'] == time]
jogador = st.selectbox("ğŸ¯ Escolha um jogador:", jogadores_time['Player'].unique())
df_jogador = jogadores_time[jogadores_time['Player'] == jogador]

# SugestÃµes do jogador
sugestoes_jogador = gerar_sugestoes_jogador(df_jogador.iloc[0])

st.subheader(f"ğŸ‘¤ EstatÃ­sticas de {jogador}")
st.write(df_jogador.set_index("Player").T)
st.markdown("**ğŸ¤– SugestÃµes da IA:**")
for s in sugestoes_jogador:
    st.success(s)

# GrÃ¡fico jogador
st.subheader("ğŸ“ˆ GrÃ¡fico â€“ Jogador")
fig_jogador = px.bar(df_jogador.melt(id_vars=["Player", "Squad"], value_vars=["Gls", "Sh", "SoT"]),
                     x='variable', y='value', color='variable', title=f"{jogador} â€“ EstatÃ­sticas")
st.plotly_chart(fig_jogador)
